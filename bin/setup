#!/usr/bin/env ruby
require "fileutils"

# path to your application root.
APP_ROOT = File.expand_path("..", __dir__)

def system!(*args)
  puts "â¡ï¸  Running '#{args}'"
  system(*args) || abort("ğŸ›‘ Command #{args} failed")
end

FileUtils.chdir APP_ROOT do
  puts "âœ… Installing gems"
  system("bundle check") || system!("bundle install")

  puts "âœ… Dropping dev & test databases"
  system! "bin/rails db:drop"
  puts "âœ… Preparing dev & test databases"
  system! "bin/rails db:prepare"
  puts "âœ… Loading seeds into dev database"
  system! "bin/rails db:seed"

  puts "âœ… Everything looks good"
  puts
  puts "    bin/rails s                 # start the app"
  puts "    bin/rails c                 # get Rails console/REPL"
  puts "    bin/rails dbconsole         # get a SQL console into the dev database"
  puts "    bin/rails dbconsole -e test # get a SQL console into the test database"
  puts
  puts "    Testing:"
  puts "        bin/rspec                             # run all tests"
  puts "        bin/rspec spec/features               # run all integration tests"
  puts "        bin/rspec spec/models/product_spec.rb # Run just the tests in product_spec.rb"
  puts
  puts "Also, don't forget to look at the README"
end
